<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>

    <script>
    // Firebase í”„ë¡œì íŠ¸ ì„¤ì • (ë³¸ì¸ í”„ë¡œì íŠ¸ë¡œ êµì²´!)
    
    const firebaseConfig = {
      apiKey: "AIzaSyCv9qO_dTwSXTACNjrjQ5H13h09JzJwN9A",
      authDomain: "dailyroutine-ea1a1.firebaseapp.com",
      projectId: "dailyroutine-ea1a1",
      storageBucket: "dailyroutine-ea1a1.firebasestorage.app",
      messagingSenderId: "389292492309",
      appId: "1:389292492309:web:77dea07659d73391f3b01c",
      measurementId: "G-XQ2D0VB96G"
    };


    // Firebase ì´ˆê¸°í™”
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í†µí•© ì¼ì¼ ë£¨í‹´ ê´€ë¦¬</title>
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f4f8;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .title {
            font-size: 28px;
            font-weight: bold;
            color: #1a365d;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 16px;
            color: #4a5568;
            margin-bottom: 20px;
        }

        .date-info {
            font-size: 14px;
            color: #718096;
            font-style: italic;
        }

        .main-container {
            display: grid;
            grid-template-columns: 2fr 0.7fr;
            gap: 30px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* ì™¼ìª½ ì˜ì—­ - ì£¼ê°„ ì—…ë¬´ ì²´í¬ë¦¬ìŠ¤íŠ¸ */
        .weekly-tasks {
            background-color: white;
            border: 2px solid #1a365d;
            border-radius: 10px;
            padding: 10px;
        }

        .section-header {
            font-size: 20px;
            font-weight: bold;
            color: #1a365d;
            margin-bottom: 15px;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }

        .week-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .week-btn {
            padding: 8px 16px;
            border: 2px solid #1a365d;
            background-color: white;
            color: #1a365d;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 12px;
        }

        .week-btn:hover {
            background-color: #e2e8f0;
            transform: translateY(-2px);
        }

        .week-btn.active {
            background-color: #1a365d;
            color: white;
        }

        .weekly-progress {
            text-align: center;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #e2e8f0;
            border-radius: 5px;
            color: #1a365d;
            font-weight: bold;
            font-size: 16px;
        }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }

        .day-card {
            background-color: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 10px;
            min-height: 200px;
        }

        .day-header {
            font-weight: bold;
            font-size: 14px;
            color: #1a365d;
            text-align: center;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #e2e8f0;
        }

        .day-card.today {
            border: 3px solid #4299e1;
            background-color: #ebf8ff;
        }

        .day-card.weekend {
            background-color: #fef5e7;
            border-color: #f6ad55;
        }

        .task-item {
            font-size: 11px;
            margin: 2px 0;
            padding: 2px 4px;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid #4299e1;
            background-color: #ebf8ff;
            color: #1a365d;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .task-item:hover {
            transform: scale(1.02);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .task-item.completed {
            opacity: 0.7;
            text-decoration: line-through;
            background-color: #c6f6d5;
            border-left-color: #38a169;
        }

        .task-name {
            flex: 1;
        }

        .task-time {
            font-size: 8px;
            color: #666;
            margin-left: 4px;
            font-weight: normal;
        }

        .completion-counter {
            text-align: center;
            font-size: 10px;
            font-weight: bold;
            color: #1a365d;
            background-color: #e2e8f0;
            padding: 2px 5px;
            border-radius: 10px;
            margin-top: 5px;
        }

        .weekend-placeholder {
            text-align: center;
            font-size: 12px;
            color: #d69e2e;
            font-weight: bold;
            margin: 10px 0;
            padding: 10px;
            background-color: #fff8dc;
            border: 2px dashed #f6ad55;
            border-radius: 8px;
        }

        /* ì˜¤ë¥¸ìª½ ì˜ì—­ - ìš´ë™ ë£¨í‹´ */
        .exercise-area {
            background-color: white;
            border: 2px solid #2d5016;
            border-radius: 10px;
            padding: 10px;
        }

        .exercise-area .section-header {
            color: #2d5016;
            border-bottom-color: #e6f3e6;
        }

        .exercise-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .exercise-btn {
            padding: 8px 16px;
            border: 2px solid #2d5016;
            background-color: white;
            color: #2d5016;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 12px;
        }

        .exercise-btn:hover {
            background-color: #e6f3e6;
        }

        .exercise-btn.active {
            background-color: #2d5016;
            color: white;
        }

        .routine-info {
            text-align: center;
            margin-bottom: 15px;
            padding: 8px;
            background-color: #e7f4fc;
            border-radius: 5px;
            color: #2d5016;
            font-weight: bold;
            font-size: 12px;
        }

        .routine-groups {
            display: grid;
            gap: 15px;
        }

        .routine-group {
            background-color: #f9f9f9;
            padding: 12px;
            border-radius: 8px;
        }

        .routine-group.warmup {
            border-left: 4px solid #3498db;
        }

        .routine-group.main {
            border-left: 4px solid #e74c3c;
        }

        .routine-group.cooldown {
            border-left: 4px solid #27ae60;
        }

        .routine-group.strength {
            border-left: 4px solid #e74c3c;
        }

        .routine-group.flexibility {
            border-left: 4px solid #3498db;
        }

        .routine-group.golf-basic {
            border-left: 4px solid #27ae60;
        }

        .routine-group h4 {
            margin: 0 0 10px 0;
            font-size: 14px;
            text-align: center;
            font-weight: bold;
        }

        .routine-group.warmup h4 { color: #3498db; }
        .routine-group.main h4 { color: #e74c3c; }
        .routine-group.cooldown h4 { color: #27ae60; }
        .routine-group.strength h4 { color: #e74c3c; }
        .routine-group.flexibility h4 { color: #3498db; }
        .routine-group.golf-basic h4 { color: #27ae60; }

        .routine-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .exercise-item {
            margin: 6px 0;
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid #ddd;
            text-align: center;
            font-size: 11px;
        }

        .exercise-name {
            font-weight: bold;
            margin-bottom: 2px;
        }

        .exercise-duration {
            font-size: 10px;
            color: #666;
            font-weight: normal;
        }

        .exercise-item.warmup { 
            background-color: #e7f4fc; 
            border-color: #3498db; 
        }
        .exercise-item.warmup .exercise-name { color: #3498db; }

        .exercise-item.main { 
            background-color: #fce7e7; 
            border-color: #e74c3c; 
        }
        .exercise-item.main .exercise-name { color: #e74c3c; }

        .exercise-item.cooldown { 
            background-color: #e8f9e8; 
            border-color: #27ae60; 
        }
        .exercise-item.cooldown .exercise-name { color: #27ae60; }

        .exercise-item.strength { 
            background-color: #fce7e7; 
            border-color: #e74c3c; 
        }
        .exercise-item.strength .exercise-name { color: #e74c3c; }

        .exercise-item.flexibility { 
            background-color: #e7f4fc; 
            border-color: #3498db; 
        }
        .exercise-item.flexibility .exercise-name { color: #3498db; }

        .exercise-item.golf-basic { 
            background-color: #e8f9e8; 
            border-color: #27ae60; 
        }
        .exercise-item.golf-basic .exercise-name { color: #27ae60; }

        .exercise-item.completed {
            opacity: 0.6;
            text-decoration: line-through;
            background-color: #f0f0f0;
            border-color: #ccc;
        }

        .exercise-item.completed .exercise-name,
        .exercise-item.completed .exercise-duration {
            color: #888;
        }

        .exercise-item:hover:not(.completed) {
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        @media (max-width: 768px) {
            .days-grid {
                grid-template-columns: 1fr;
            }
            
            .day-card {
                min-height: 150px;
            }
            
            .week-btn, .exercise-btn {
                padding: 6px 12px;
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="title">ğŸ—“ï¸ í†µí•© ì¼ì¼ ë£¨í‹´ ê´€ë¦¬</div>
        <div class="subtitle">ê¾¸ì¤€í•œ ì¼ìƒ ê´€ë¦¬ì™€ ìš´ë™ìœ¼ë¡œ ì„±ì¥í•˜ëŠ” ë§¤ì¼ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”!</div>
        <div class="date-info" style="font-size:9px;">ver. 20251101_01</div>
        <div class="date-info" id="dateInfo"></div>
        <div id="authContainer" style="max-width:400px; margin:5px auto; padding:5px; border-radius:3px; text-align:center;">        
        <form id="authForm">
            <input type="email" id="email" placeholder="ì´ë©”ì¼" required 
                style="width:100%; padding:10px; margin:8px 0; border:1px solid #ccc; border-radius:6px; font-size:10px;">
            <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸ (6ì ì´ìƒ)" required minlength="6"
                style="width:100%; padding:10px; margin:8px 0; border:1px solid #ccc; border-radius:6px; font-size:10px;">
            
            <div style="display:flex; gap:10px; margin-top:5px;">
            <button type="submit" id="loginBtn" 
                    style="flex:1; padding:12px; background:#1a365d; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:bold;">
                ë¡œê·¸ì¸
            </button>
            <button type="button" id="signupBtn" 
                    style="flex:1; padding:12px; background:#2d5016; color:white; border:none; border-radius:6px; cursor:pointer; font-weight:bold;">
                íšŒì›ê°€ì…
            </button>
            </div>
        </form>

        <div id="authMessage" style="margin-top:5px; color:#e74c3c; font-size:10px;"></div>
        <div id="userInfo" style="margin-top:5px; display:none; align-items:center; justify-content:center; gap:10px;">
            <img id="userPhoto" width="40" style="border-radius:50%;">
            <span id="userName" style="font-weight:normal; font-size:10px;"></span>
            <button id="logoutBtn" style="padding:6px 10px; font-size:10px; background:#e74c3c; color:white; border:none; border-radius:4px; cursor:pointer;">
            ë¡œê·¸ì•„ì›ƒ
            </button>
        </div>
    </div>
      

    <div class="main-container">
        <div class="weekly-tasks">
            <div class="section-header">ğŸ“‹ ì£¼ê°„ ì—…ë¬´ ì²´í¬ë¦¬ìŠ¤íŠ¸</div>
            
            <div class="week-selector" id="weekSelector">
                </div>
            
            <div class="weekly-progress" id="weeklyProgress">
                </div>
            
            <div class="days-grid" id="daysGrid">
                </div>
        </div>

        <div class="exercise-area">
            <div class="section-header">ğŸƒâ€â™‚ï¸ ì˜¤ëŠ˜ì˜ ìš´ë™ ë£¨í‹´</div>
            
            <div class="exercise-selector">
                <button class="exercise-btn active" onclick="selectExercise('swimming')" id="swimmingBtn">ğŸŠâ€â™‚ï¸ MEDITATION</button>
                <button class="exercise-btn" onclick="selectExercise('golf')" id="golfBtn">â›³ WORKOUT</button>
            </div>
            
            <div class="routine-info" id="routineInfo">
                </div>
            
            <div class="routine-groups" id="routineGroups">
                </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentUser = null;
        let unsubscribeTasks = null;
        let unsubscribeExercise = null;

        const tasks = [ /* ê¸°ì¡´ tasks ë°°ì—´ ê·¸ëŒ€ë¡œ */ 
            { name: "Pills&Coffee", type: "health" },
            { name: "UPhone", type: "study" },
            { name: "E-Mail", type: "work" },
            { name: "Flashcard", type: "interest" },                       
            { name: "In-person", type: "study" },
            { name: "Report", type: "business" },
            { name: "Book/Paper", type: "study" },
            { name: "Dymola", type: "technical" },
            { name: "AI-Coding", type: "technical" },
            { name: "Shadowing", type: "reading" },
            { name: "Swimming", type: "exercise" },
            { name: "Planning", type: "planning" }
        ];

        const startDate = new Date(2025, 7, 31);
        let currentWeek = 1;
        let currentExercise = 'swimming';

        const swimmingDatabase = { /* ê¸°ì¡´ ê·¸ëŒ€ë¡œ */ };
        const golfDatabase = [ /* ê¸°ì¡´ ê·¸ëŒ€ë¡œ */ ];

        // === UI ìš”ì†Œ ===
        const authForm = document.getElementById('authForm');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const loginBtn = document.getElementById('loginBtn');
        const signupBtn = document.getElementById('signupBtn');
        const authMessage = document.getElementById('authMessage');
        const userInfo = document.getElementById('userInfo');
        const userName = document.getElementById('userName');
        const logoutBtn = document.getElementById('logoutBtn');

        // === ì¸ì¦ ìƒíƒœ ê°ì‹œ ===
        firebase.auth().onAuthStateChanged(user => {
            if (user) {
            currentUser = user;
            document.getElementById('authContainer').querySelector('form').style.display = 'none';
            userInfo.style.display = 'flex';
            userName.textContent = user.email;
            loadUserData();
            } else {
            currentUser = null;
            document.getElementById('authContainer').querySelector('form').style.display = 'block';
            userInfo.style.display = 'none';
            clearAllData();
            }
        });

        // === ë¡œê·¸ì¸ ===
        loginBtn.onclick = async (e) => {
            e.preventDefault();
            const email = emailInput.value.trim();
            const password = passwordInput.value;
            if (!email || !password) return showMessage('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');

            try {
            await firebase.auth().signInWithEmailAndPassword(email, password);
            showMessage('ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
            } catch (error) {
            showMessage(getErrorMessage(error.code));
            }
        };

        // === íšŒì›ê°€ì… ===
        signupBtn.onclick = async () => {
            const email = emailInput.value.trim();
            const password = passwordInput.value;
            if (!email || !password) return showMessage('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');

            try {
            await firebase.auth().createUserWithEmailAndPassword(email, password);
            showMessage('íšŒì›ê°€ì… ì„±ê³µ! ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            } catch (error) {
            showMessage(getErrorMessage(error.code));
            }
        };

        // === ë¡œê·¸ì•„ì›ƒ ===
        logoutBtn.onclick = () => {
            firebase.auth().signOut();
        };

        // === ì—ëŸ¬ ë©”ì‹œì§€ í•œê¸€í™” ===
        function getErrorMessage(code) {
            const messages = {
            'auth/user-not-found': 'ê°€ì…ë˜ì§€ ì•Šì€ ì´ë©”ì¼ì…ë‹ˆë‹¤.',
            'auth/wrong-password': 'ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.',
            'auth/email-already-in-use': 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤.',
            'auth/weak-password': 'ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.',
            'auth/invalid-email': 'ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë©”ì¼ í˜•ì‹ì…ë‹ˆë‹¤.',
            'auth/too-many-requests': 'ë„ˆë¬´ ë§ì€ ì‹œë„. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.'
            };
            return messages[code] || 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
        }

        function showMessage(msg, type = 'error') {
            authMessage.textContent = msg;
            authMessage.style.color = type === 'success' ? '#27ae60' : '#e74c3c';
            setTimeout(() => authMessage.textContent = '', 3000);
        }

        // === Firestore ë°ì´í„° ë¡œë“œ ===
        function loadUserData() {
            if (!currentUser) return;

            const userRef = db.collection('users').doc(currentUser.uid);

            if (unsubscribeTasks) unsubscribeTasks();
            unsubscribeTasks = userRef.collection('weeklyTasks').onSnapshot(snapshot => {
            taskProgress = {};
            snapshot.forEach(doc => { taskProgress[doc.id] = doc.data(); });
            updateWeekView();
            }, err => console.error('íƒœìŠ¤í¬ ë¡œë“œ ì˜¤ë¥˜:', err));

            if (unsubscribeExercise) unsubscribeExercise();
            unsubscribeExercise = userRef.collection('exerciseProgress').onSnapshot(snapshot => {
            exerciseProgress = {};
            snapshot.forEach(doc => { exerciseProgress[doc.id] = doc.data(); });
            updateExerciseView();
            }, err => console.error('ìš´ë™ ë¡œë“œ ì˜¤ë¥˜:', err));
        }

        // === ë°ì´í„° ì €ì¥ ===
        async function saveTaskProgress(taskId, data) {
            if (!currentUser) return;
            try {
            await db.collection('users').doc(currentUser.uid)
                    .collection('weeklyTasks').doc(taskId).set(data, { merge: true });
            } catch (err) {
            console.error('íƒœìŠ¤í¬ ì €ì¥ ì‹¤íŒ¨:', err);
            }
        }

        async function saveExerciseProgress(dateKey, index, completed) {
            if (!currentUser) return;
            const docRef = db.collection('users').doc(currentUser.uid)
                            .collection('exerciseProgress').doc(dateKey);
            try {
            if (completed) {
                await docRef.set({ [index]: true }, { merge: true });
            } else {
                const doc = await docRef.get();
                if (doc.exists && doc.data()[index] !== undefined) {
                await docRef.update({ [index]: firebase.firestore.FieldValue.delete() });
                }
            }
            } catch (err) {
            console.error('ìš´ë™ ì €ì¥ ì‹¤íŒ¨:', err);
            }
        }

        // === ê¸°ì¡´ í•¨ìˆ˜ë“¤ (Firestore ê¸°ë°˜) ===
        let taskProgress = {};
        let exerciseProgress = {};

        function getWeekNumber(date) {
            const diffTime = date.getTime() - startDate.getTime();
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            return Math.floor(diffDays / 7) + 1;
        }

        function createWeekSelector() {
            const selector = document.getElementById('weekSelector');
            const today = new Date();
            const currentWeekNum = getWeekNumber(today);
            
            for (let week = 1; week <= 20; week++) {
            const btn = document.createElement('button');
            btn.className = 'week-btn';
            btn.textContent = `W${week}`;
            btn.dataset.week = week;
            btn.onclick = () => selectWeek(week);
            if (week === currentWeekNum) {
                btn.classList.add('active');
                currentWeek = week;
            }
            selector.appendChild(btn);
            }            
        }

        function selectWeek(week) {
            currentWeek = week;
            document.querySelectorAll('.week-btn').forEach(b => b.classList.remove('active'));
            document.querySelector(`.week-btn[data-week="${week}"]`).classList.add('active');
            updateWeekView();
        }

        function updateWeekView() {
            const today = new Date();
            const weekStart = new Date(startDate);
            weekStart.setDate(startDate.getDate() + (currentWeek - 1) * 7);
            
            updateWeeklyProgress();
            
            const daysGrid = document.getElementById('daysGrid');
            daysGrid.innerHTML = '';
            
            const dayNames = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
            
            for (let i = 0; i < 7; i++) {
            const currentDate = new Date(weekStart);
            currentDate.setDate(weekStart.getDate() + i);
            
            const dayCard = document.createElement('div');
            dayCard.className = 'day-card';
            if (currentDate.toDateString() === today.toDateString()) dayCard.classList.add('today');
            if (i === 0 || i === 6) dayCard.classList.add('weekend');
            
            const dayHeader = document.createElement('div');
            dayHeader.className = 'day-header';
            dayHeader.textContent = `${dayNames[i]} (${currentDate.getMonth() + 1}/${currentDate.getDate()})`;
            dayCard.appendChild(dayHeader);
            
            if (i === 0 || i === 6) {
                const placeholder = document.createElement('div');
                placeholder.className = 'weekend-placeholder';
                placeholder.innerHTML = i === 0 
                ? 'í•˜ê³  ì‹¶ì€ ì¼ ë¯¸ë¦¬í•˜ê¸°<br><br>ì•½ë¨¹ê¸°<br>ìŠì§€ ì•Šê¸°'
                : 'ëª»í•œ ì¼<br>ì™„ë£Œí•˜ê¸°<br><br>ì•½ë¨¹ê¸°<br>ìŠì§€ ì•Šê¸°';
                dayCard.appendChild(placeholder);
            } else {
                let completedCount = 0;
                tasks.forEach((task, index) => {
                const taskId = `${currentWeek}-${i}_task${index}`;
                const taskData = taskProgress[taskId] || {};
                const isCompleted = taskData.completed || false;
                if (isCompleted) completedCount++;
                
                const taskItem = document.createElement('div');
                taskItem.className = `task-item ${isCompleted ? 'completed' : ''}`;
                taskItem.onclick = () => toggleTask(taskId, taskItem);
                
                taskItem.innerHTML = `
                    <span class="task-name">${task.name}</span>
                    <span class="task-time">${taskData.time || ''}</span>
                `;
                dayCard.appendChild(taskItem);
                });
                
                const counter = document.createElement('div');
                counter.className = 'completion-counter';
                counter.textContent = `${completedCount}/${tasks.length}`;
                dayCard.appendChild(counter);
            }
            daysGrid.appendChild(dayCard);
            }
        }

        function updateWeeklyProgress() {
            const totalTasks = tasks.length * 5;
            let completedTasks = 0;
            
            for (let day = 1; day <= 5; day++) {
            tasks.forEach((task, index) => {
                const taskId = `${currentWeek}-${day}_task${index}`;
                if (taskProgress[taskId]?.completed) completedTasks++;
            });
            }
            
            const progressPercent = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            document.getElementById('weeklyProgress').textContent = 
            `${currentWeek}ì£¼ì°¨ ì§„í–‰ë¥ : ${progressPercent}% (${completedTasks}/${totalTasks} ì™„ë£Œ)`;
        }

        async function toggleTask(taskId, element) {
            const now = new Date();
            const timeString = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
            
            if (element.classList.contains('completed')) {
            element.classList.remove('completed');
            await saveTaskProgress(taskId, { 
                completed: firebase.firestore.FieldValue.delete(), 
                time: firebase.firestore.FieldValue.delete() 
            });
            element.querySelector('.task-time').textContent = '';
            } else {
            element.classList.add('completed');
            await saveTaskProgress(taskId, { completed: true, time: timeString });
            element.querySelector('.task-time').textContent = timeString;
            }
            
            const dayCard = element.parentElement;
            const counter = dayCard.querySelector('.completion-counter');
            if (counter) {
            const completedItems = dayCard.querySelectorAll('.task-item.completed').length;
            const totalItems = dayCard.querySelectorAll('.task-item').length;
            counter.textContent = `${completedItems}/${totalItems}`;
            }
            updateWeeklyProgress();
        }

        // === ìš´ë™ ê´€ë ¨ í•¨ìˆ˜ (ê¸°ì¡´ ìœ ì§€) ===
        function selectExercise(type) {
            currentExercise = type;
            document.querySelectorAll('.exercise-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`${type}Btn`).classList.add('active');
            updateExerciseView();
        }

        function updateExerciseView() {
            const today = new Date();
            const dayOfWeek = today.getDay();
            if (currentExercise === 'swimming') updateSwimmingView();
            else updateGolfView(dayOfWeek);
        }

        function updateSwimmingView() {
            document.getElementById('routineInfo').textContent = 'ì´ ì†Œìš”ì‹œê°„: ì•½ 20ë¶„ (ì´ˆë³´ì ë§ì¶¤í˜•)';
            const routineGroups = document.getElementById('routineGroups');
            routineGroups.innerHTML = `
            <div class="routine-group warmup"><h4>ìŠ¤íŠ¸ë ˆì¹­ (10ë¶„)</h4><ul class="routine-list" id="warmupList"></ul></div>
            <div class="routine-group main"><h4>ì´ë¯¸ì§€ íŠ¸ë ˆì´ë‹ (10ë¶„)</h4><ul class="routine-list" id="mainList"></ul></div>
            <div class="routine-group cooldown"><h4>ëª…ìƒ (5~8ë¶„)</h4><ul class="routine-list" id="cooldownList"></ul></div>
            `;

            const todayRoutine = {
            warmup: getRandomExercises(swimmingDatabase.warmup, 1),
            main: getRandomExercises(swimmingDatabase.main, 3),
            cooldown: getRandomExercises(swimmingDatabase.cooldown, 1)
            };

            const todayKey = new Date().toLocaleDateString() + '_swimming';
            const savedProgress = exerciseProgress[todayKey] || {};

            let exerciseIndex = 0;
            Object.keys(todayRoutine).forEach(category => {
            const list = document.getElementById(`${category}List`);
            todayRoutine[category].forEach(ex => {
                const isCompleted = savedProgress[exerciseIndex] || false;
                const li = document.createElement('li');
                li.className = `exercise-item ${category} ${isCompleted ? 'completed' : ''}`;
                li.innerHTML = `<div class="exercise-name">${ex.emoji} ${ex.name} <font class="exercise-duration">${ex.duration}</font></div>`;
                li.onclick = () => openLinkAndToggle(ex.link, todayKey, exerciseIndex, li);
                list.appendChild(li);
                exerciseIndex++;
            });
            });
        }

        function updateGolfView(dayOfWeek) {
            const todayRoutine = golfDatabase.find(r => 
            Array.isArray(r.weekDay) ? r.weekDay.includes(dayOfWeek) : r.weekDay === dayOfWeek
            ) || { name: "íœ´ì‹ì¼", items: [{ name: "ê°€ë²¼ìš´ ì‚°ì±…", reps: "20-40ë¶„", type: "flexibility" }] };

            document.getElementById('routineInfo').textContent = `${todayRoutine.name} - ê¾¸ì¤€í•œ ì—°ìŠµìœ¼ë¡œ ì‹¤ë ¥ í–¥ìƒ!`;
            const routineGroups = document.getElementById('routineGroups');
            routineGroups.innerHTML = `
            <div class="routine-group strength"><h4>ê·¼ë ¥ ê°•í™”</h4><ul class="routine-list" id="strengthList"></ul></div>
            <div class="routine-group flexibility"><h4>ìœ ì—°ì„± ìš´ë™</h4><ul class="routine-list" id="flexibilityList"></ul></div>
            <div class="routine-group golf-basic"><h4>ê³¨í”„ ê¸°ì´ˆ</h4><ul class="routine-list" id="golfBasicList"></ul></div>
            `;

            const todayKey = new Date().toLocaleDateString() + '_golf';
            const savedProgress = exerciseProgress[todayKey] || {};

            const strength = getRandomExercises(todayRoutine.items.filter(i => i.type === 'strength'), 2);
            const flexibility = getRandomExercises(todayRoutine.items.filter(i => i.type === 'flexibility'), 3);
            const golfBasic = getRandomExercises(todayRoutine.items.filter(i => i.type === 'golf-basic'), 2);
            const all = [...strength, ...flexibility, ...golfBasic];

            let idx = 0;
            all.forEach(ex => {
            const isCompleted = savedProgress[idx] || false;
            const li = document.createElement('li');
            li.className = `exercise-item ${ex.type} ${isCompleted ? 'completed' : ''}`;
            li.innerHTML = `<div class="exercise-name">${ex.name} <font class="exercise-duration">${ex.reps}</font></div>`;
            li.onclick = () => openLinkAndToggle(ex.link, todayKey, idx, li);
            document.getElementById(
                ex.type === 'strength' ? 'strengthList' :
                ex.type === 'flexibility' ? 'flexibilityList' : 'golfBasicList'
            ).appendChild(li);
            idx++;
            });
        }

        function getRandomExercises(arr, n) {
            const shuffled = [...arr].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, n);
        }

        async function openLinkAndToggle(link, dateKey, index, element) {
            if (link) window.open(link, '_blank');
            await toggleExercise(dateKey, index, element);
        }

        async function toggleExercise(dateKey, index, element) {
            const completed = !element.classList.contains('completed');
            element.classList.toggle('completed', completed);
            await saveExerciseProgress(dateKey, index, completed);
        }

        function updateDateInfo() {
            const today = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
            document.getElementById('dateInfo').textContent = today.toLocaleDateString('ko-KR', options);
        }

        function selectTodayExercise() {
            const day = new Date().getDay();
            selectExercise([1,3,5,0].includes(day) ? 'swimming' : 'golf');
        }

        function clearAllData() {
            taskProgress = {};
            exerciseProgress = {};
            updateWeekView();
            updateExerciseView();
        }

        function init() {
            updateDateInfo();
            createWeekSelector();
            selectTodayExercise();
        }

        window.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
